<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!--          -->
<!-- TEMPLATE -->
<!--          -->
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	template="../../../template/advanced/template-advaced-admi.xhtml">

	<!--       -->
	<!-- TITLE -->
	<!--       -->
	<ui:define name="title-advaced">
			| Compra | Registrar
	</ui:define>

	<!--       -->
	<!-- STATU -->
	<!--       -->
	<ui:define name="component-statu-advaced">
		<p:menuitem value="Home" url="../index.xhtml" />
		<p:menuitem value="Compra" url="index.xhtml" disabled="none" />
		<p:menuitem value="Registrar" url="register.xhtml" disabled="none" />
	</ui:define>

	<!--       -->
	<!-- TITLE -->
	<!--       -->
	<ui:define name="component-title-img-advaced">
		<h:graphicImage library="img" name="all/buy.jpeg"
			styleClass="sofia-image-80 sofia-image-dark" />
	</ui:define>
	<ui:define name="component-title-h1-advaced">Compra</ui:define>
	<ui:define name="component-title-h2-advaced">Registrar</ui:define>

	<!--         -->
	<!-- SECTION -->
	<!--         -->
	<ui:define name="component-other-advaced">
		<p:fieldset legend="Registrar" toggleable="true" toggleSpeed="500">
			<!-- TITLE -->
			<h1 class="sofia-title p-my-4 p-mb-6">Registrar Compra</h1>

			<!--      -->
			<!-- FORM -->
			<!--      -->
			<h:panelGroup layout="block" styleClass="ui-fluid p-formgrid p-grid">

				<!--                 -->
				<!-- PURCHASE DETAIL -->
				<!--                 -->
				<p:fieldset legend="Detalle Compra" toggleable="true"
					toggleSpeed="500" styleClass="p-field p-col-12">

					<h:panelGroup layout="block"
						styleClass="p-grid p-justify-between p-col-12 p-mt-4">

						<!--          -->
						<!-- PROVIDER -->
						<!--          -->
						<h:panelGroup layout="block" styleClass="p-field p-col-12 p-md-3">
							<p:outputLabel for="proveedores" value="Proveedor:" />
							<p:selectOneMenu id="proveedores" filter="true"
								value="#{comprar.producto.proveedor.idProveedor}">

								<p:ajax listener="#{comprar.productosProveedor()}"
									update="productos" />

								<f:selectItem itemValue="" itemLabel="Seleccionar" />
								<f:selectItems value="#{selection.proveedores}"
									noSelectionOption="true" />
							</p:selectOneMenu>
						</h:panelGroup>

						<!--          -->
						<!-- PRODUCTS -->
						<!--          -->
						<h:panelGroup layout="block" styleClass="p-field p-col-12 p-md-3">
							<p:outputLabel for="@next" value="Productos:" />
							<p:selectOneMenu id="productos" filter="true"
								value="#{comprar.producto.producto.idProducto}">
								<f:selectItem itemValue=""
									itemLabel="Proveedor #{comprar.producto.proveedor.idProveedor>0 ? comprar.producto.proveedor.idProveedor : ''}" />
								<f:selectItems value="#{comprar.productos}" />
								<p:ajax listener="#{comprar.detallesProducto()}"
									update="@(.sofia-container-main-update)" />
							</p:selectOneMenu>
						</h:panelGroup>
					</h:panelGroup>

					<!--             -->
					<!-- DESCRIPTION -->
					<!--             -->
					<div class="p-field p-col-12 ">
						<p:outputLabel for="descripción" value="Descripción (opcional):" />
						<p:inputTextarea id="descripción" rows="4"
							value="#{comprar.compra.descripcion}" />
					</div>
				</p:fieldset>

				<!--                -->
				<!-- PRODUCT DETAIL -->
				<!--                -->
				<p:fieldset legend="Detalle Producto" toggleable="true"
					toggleSpeed="500" styleClass="p-field p-col-12">
					<h:panelGroup layout="block"
						styleClass="ui-fluid p-formgrid p-grid p-mt-5">
						<h:panelGroup layout="block"
							styleClass="p-grid p-justify-between p-col-12">

							<!--       -->
							<!-- COLOR -->
							<!--       -->
							<h:panelGroup layout="block" styleClass="p-field p-col-12 p-md-3">
								<p:outputLabel for="color-producto" value="Color:" />
								<p:inputText id="color-producto" disabled="#{comprar.hidden}"
									value="#{comprar.detalleProducto.color}" />
							</h:panelGroup>

							<!--         -->
							<!-- MEASURE -->
							<!--         -->
							<h:panelGroup layout="block" styleClass="p-field p-col-12 p-md-3">
								<p:outputLabel for="medida-producto" value="Dimensión:" />
								<p:inputText id="medida-producto" disabled="#{comprar.hidden}"
									value="#{comprar.detalleProducto.dimension}" />
							</h:panelGroup>

							<!--            -->
							<!-- SALE PRICE -->
							<!--            -->
							<h:panelGroup layout="block" styleClass="p-field p-col-12 p-md-3">
								<p:outputLabel for="precio-venta-producto" value="Precio Venta:" />
								<p:inputNumber id="precio-venta-producto"
									disabled="#{comprar.hidden}"
									value="#{comprar.detalleProducto.precioVenta}">
								</p:inputNumber>
							</h:panelGroup>
						</h:panelGroup>
					</h:panelGroup>

					<!--       -->
					<!-- OTHER -->
					<!--       -->
					<h:panelGroup layout="block"
						styleClass="ui-fluid p-formgrid p-grid p-mt-5">
						<h:panelGroup layout="block"
							styleClass="p-d-flex p-justify-center p-col-12">
							<h:panelGroup layout="block"
								styleClass="p-grid p-justify-center p-col-12">

								<!--          -->
								<!-- SALE BUY -->
								<!--          -->
								<h:panelGroup layout="block"
									styleClass="p-field p-col-12 p-md-3">
									<p:outputLabel for="cantidad" value="Cantidad:" />
									<p:spinner id="cantidad" title="Cantidad de producto."
										value="#{comprar.detalleCompra.cantidad}" />
								</h:panelGroup>

								<h:panelGroup layout="block"
									styleClass="p-field p-col-12 p-md-3">
									<p:outputLabel for="precio" value="Precio U/D:" />
									<p:inputNumber id="precio" title="Precio Compra."
										value="#{comprar.detalleCompra.precio}">
									</p:inputNumber>
								</h:panelGroup>

								<h:panelGroup layout="block"
									styleClass="p-field p-col-12 p-md-3">
									<p:outputLabel for="descuento" value="Descuento:" />
									<p:inputNumber id="descuento" title="Descuento producto."
										disabled="#{comprar.hidden}"
										value="#{comprar.detalleProducto.descuento}">
									</p:inputNumber>
								</h:panelGroup>

							</h:panelGroup>
						</h:panelGroup>
					</h:panelGroup>

					<!--                 -->
					<!-- PRODUCT DETAILS -->
					<!--                 -->
					<p:fieldset legend="Detalles" toggleable="true" toggleSpeed="500"
						styleClass="p-field p-col-12"
						rendered="#{comprar.detalles.size() >0 }">

						<!--       -->
						<!-- TABLE -->
						<!--       -->
						<p:dataTable var="c" value="#{comprar.detalles}"
							id="table-detalle-product" rowIndexVar="index" paginator="true"
							rows="10" rowsPerPageTemplate="5,10,15,20,50"
							paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} 
										       {PreviousPageLink} {CurrentPageReport} 
										       {NextPageLink} {LastPageLink}"
							styleClass="p-m-3" reflow="true" scrollable="true"
							emptyMessage="No se ha encontrado ningun detalle de producto.">

							<!--       -->
							<!-- TITLE -->
							<!--       -->
							<f:facet name="header">
								<h2>Detalles Producto</h2>
							</f:facet>

							<!-- ID -->
							<p:column footerText="ID">
								<f:facet name="header">
									<h:outputText value="ID" />
								</f:facet>
								<h:panelGroup layout="block"
									styleClass="p-d-flex p-jc-center p-ac-center">
									<h:outputText value="#{c.id}" />
								</h:panelGroup>
							</p:column>

							<!-- COLOR -->
							<p:column footerText="Color">
								<f:facet name="header">
									<h:outputText value="Color" />
								</f:facet>
								<h:panelGroup layout="block"
									styleClass="p-d-flex p-jc-center p-ac-center">
									<h:outputText value="#{c.color}" />
								</h:panelGroup>

							</p:column>

							<!-- MEDIDA -->
							<p:column footerText="Medida">
								<f:facet name="header">
									<h:outputText value="Dimensión" />
								</f:facet>
								<h:panelGroup layout="block"
									styleClass="p-d-flex p-jc-end p-ac-center">
									<h:outputText value="#{c.dimension}" />
								</h:panelGroup>
							</p:column>

							<!-- BUTTONS -->
							<p:column width="100">
								<h:panelGroup layout="block"
									styleClass="p-d-flex p-jc-center  p-ac-center">
									<p:commandButton icon="fa fa-fw fa-plus-square"
										action="#{comprar.addDetalleProducto()}"
										update="@(.sofia-container-main-update)"
										styleClass="sofia-button-icon sofia-button-icon sofia-button-succes">
										<f:param name="index-detalle-producto" value="#{index}" />
									</p:commandButton>
								</h:panelGroup>
							</p:column>
						</p:dataTable>
					</p:fieldset>
				</p:fieldset>

				<!--         -->
				<!-- ACTIONS -->
				<!--         -->

				<!--     -->
				<!-- ADD -->
				<!--     -->
				<h:panelGroup layout="block" styleClass="p-p-5 p-d-flex p-col-12">
					<p:commandButton icon="fa fa-fw fa-plus-square"
						styleClass="sofia-button-succes sofia-button-icon"
						update="@(.sofia-container-main-update)" title="Agregar Producto"
						action="#{comprar.addProducto()}" />
				</h:panelGroup>

				<!--     -->
				<!-- BUY -->
				<!--     -->
				<p:fieldset legend="Historial Compra" toggleable="true"
					toggleSpeed="500" rendered="#{comprar.tabla.size() > 0}">

					<h1 class="sofia-title p-mb-4 p-mt-2">Historial Compra</h1>

					<!--       -->
					<!-- TABLE -->
					<!--       -->
					<h:panelGroup layout="block" styleClass="p-mb-4">
						<p:dataTable rendered="#{comprar.tabla.size() > 0}" var="c"
							value="#{comprar.tabla}" id="sofia-table-update"
							rowIndexVar="index" widgetVar="sofia-table-update"
							emptyMessage="No se ha comprado ningun producto."
							paginator="true" rows="10" rowsPerPageTemplate="5,10,15,20,50"
							paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} 
										{PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
							reflow="true" scrollable="true">

							<!--       -->
							<!-- TITLE -->
							<!--       -->
							<f:facet name="header">
								<h:panelGroup layout="block"
									styleClass="p-d-flex p-jc-center p-ac-center">
									<h2>Compra</h2>
									<h4 class="p-as-end">(#{comprar.tabla.size()} Resultados)</h4>
								</h:panelGroup>
							</f:facet>

							<!--              -->
							<!-- HEADER GROUP -->
							<!--              -->
							<p:columnGroup type="header">
								<p:row>
									<p:column headerText="Proveedor" />
									<p:column colspan="3" headerText="Producto" />
									<p:column rowspan="2" headerText="SubTotal" />
								</p:row>
								<p:row>
									<p:column headerText="Nombre" sortBy="#{c.proveedor.nombre}" />
									<p:column headerText="Nombre" />
									<p:column headerText="Cantidad" sortBy="#{c.cantidad}" />
									<p:column headerText="Precio"
										sortBy="#{c.detalleProducto.precioCosto}" />
								</p:row>
							</p:columnGroup>

							<!--          -->
							<!-- PROVIDER -->
							<!--          -->
							<p:column>
								<p:rowToggler />
								<h:panelGroup layout="block"
									styleClass="p-d-flex p-jc-center p-ac-center">
									<h:outputLabel>#{c.proveedor.nombre}</h:outputLabel>
								</h:panelGroup>

							</p:column>

							<!--         -->
							<!-- PRODUCT -->
							<!--         -->
							<p:column>
								<h:panelGroup styleClass="p-d-flex p-jc-center p-ac-center">
									<p>#{c.detalleProducto.producto.nombre}</p>
								</h:panelGroup>
							</p:column>

							<!--       -->
							<!-- COUNT -->
							<!--       -->
							<p:column>
								<h:panelGroup styleClass="p-d-flex p-jc-center p-ac-center">
									<h:outputText value="#{c.cantidad}" />
								</h:panelGroup>
							</p:column>

							<!--       -->
							<!-- PRICE -->
							<!--       -->
							<p:column>
								<h:panelGroup styleClass="p-d-flex p-jc-end p-ac-center">
									<h:outputText value="$#{c.detalleProducto.precioCosto}" />
								</h:panelGroup>
							</p:column>

							<!--          -->
							<!-- SUBTOTAL -->
							<!--          -->
							<p:column>
								<h:panelGroup styleClass="p-d-flex p-jc-end p-ac-center">
									<h:outputText title="Subtotal precio."
										value="$#{comprar.subTotal(c.cantidad,
										c.detalleProducto.precioCosto)}" />
								</h:panelGroup>
							</p:column>

							<!--        -->
							<!-- EXPANT -->
							<!--        -->
							<p:rowExpansion>
								<h:panelGroup layout="block" styleClass="p-m-4">
									<h4>Detalle Producto #{c.detalleProducto.producto.nombre}</h4>

									<h:panelGroup layout="block"
										styleClass="ui-fluid p-formgrid p-grid p-m-4">
										<h:panelGroup layout="block"
											styleClass="p-grid p-justify-between p-col-12 p-mb-3">
											<h:panelGroup layout="block"
												styleClass="p-field p-col-12 p-md-3">
												<p:outputLabel for="info-id-proveedor" value="ID Proveedor:" />
												<p:inputText id="info-id-proveedor"
													value="#{c.proveedor.idProveedor}" disabled="true" />
											</h:panelGroup>
											<h:panelGroup layout="block"
												styleClass="p-field p-col-12 p-md-3">
												<p:outputLabel for="info-id-producto" value="ID Producto:" />
												<p:inputText id="info-id-producto"
													value="#{c.detalleProducto.producto.idProducto}"
													disabled="true" />
											</h:panelGroup>
										</h:panelGroup>

										<h:panelGroup layout="block"
											styleClass="p-grid p-justify-between p-col-12">
											<h:panelGroup layout="block"
												styleClass="p-field p-col-12 p-md-3">
												<p:outputLabel for="info-color" value="Color:" />
												<p:inputText id="info-color"
													value="#{c.detalleProducto.color}" disabled="true" />
											</h:panelGroup>
											<h:panelGroup layout="block"
												styleClass="p-field p-col-12 p-md-3">
												<p:outputLabel for="info-medida" value="Dimensión:" />
												<p:inputText id="info-medida"
													value="#{c.detalleProducto.dimension}" disabled="true" />
											</h:panelGroup>

											<h:panelGroup layout="block"
												styleClass="p-field p-col-12 p-md-3">
												<p:outputLabel for="info-descuento" value="Descuento:" />
												<p:inputText id="info-descuento"
													value="#{c.detalleProducto.descuento}" disabled="true" />
											</h:panelGroup>

											<h:panelGroup layout="block"
												styleClass="p-field p-col-12 p-md-3">
												<p:outputLabel for="info-precio-venta" value="Precio Venta:" />
												<p:inputText id="info-precio-venta"
													value="#{c.detalleProducto.precioVenta}" disabled="true" />
											</h:panelGroup>
										</h:panelGroup>
									</h:panelGroup>

									<p:separator />

									<!--         -->
									<!-- ACTIONS -->
									<!--         -->
									<h:panelGroup layout="block"
										styleClass="p-m-4 p-d-flex p-jc-center">
										<p:commandButton action="#{comprar.eliminarCompra()}"
											icon="fa fa-fw fa-trash-alt" style="width:auto"
											styleClass="sofia-button-error sofia-button-icon"
											title="Eliminar Compra #{c.detalleProducto.producto.nombre}"
											oncomplete="PF('sofia-table-update').clearFilters()"
											update="@(.sofia-container-main-update)">
											<f:param name="eliminar-compra-indice" value="#{index}" />
											<p:confirm header="Eliminar Compra"
												icon="pi pi-exclamation-triangle"
												message="¿Quieres eliminar la compra de #{c.detalleProducto.producto.nombre}?" />
										</p:commandButton>
									</h:panelGroup>

								</h:panelGroup>
							</p:rowExpansion>

							<!--        -->
							<!-- FOOTER -->
							<!--        -->
							<p:columnGroup type="footer">
								<!--       -->
								<!-- TOTAL -->
								<!--       -->
								<p:row>
									<p:column footerText="$#{comprar.compra.total}"
										style="text-align:right" />
								</p:row>
							</p:columnGroup>

							<!--         -->
							<!-- ACTIONS -->
							<!--         -->
							<f:facet name="footer">
								<h:panelGroup layout="block" styleClass="p-d-flex p-jc-end">

									<!--          -->
									<!-- REGISTER -->
									<!--          -->
									<p:commandButton rendered="#{comprar.tabla.size() > 0}"
										title="Registrar Compra" icon="fa fa-fw fa-paper-plane"
										styleClass="sofia-button-succes sofia-button-icon" />

									<!--        -->
									<!-- REMOVE -->
									<!--        -->
									<p:commandButton action="#{comprar.eliminar()}"
										update="@(.sofia-container-main-update)"
										oncomplete="PF('sofia-table-update').clearFilters()"
										rendered="#{comprar.tabla.size() > 0}"
										title="Eliminar todos los registros"
										styleClass="sofia-button-error sofia-button-icon"
										icon="fa fa-fw fa-trash-alt">
										<p:confirm header="Eliminar" icon="pi pi-exclamation-triangle"
											message="¿Quiere eliminar las #{comprar.tabla.size()} compras?" />
									</p:commandButton>

									<!--         -->
									<!-- REFREHS -->
									<!--         -->
									<p:commandButton action="#{comprar.recargar()}"
										oncomplete="PF('sofia-table-update').clearFilters()"
										styleClass="sofia-button-warn sofia-button-icon"
										update="@(.sofia-container-main-update)"
										title="Actualizar Tabla" icon="fa fa-fw fa-spinner" />
								</h:panelGroup>
							</f:facet>
						</p:dataTable>

						<!--        -->
						<!-- REPORT -->
						<!--        -->
						<p:commandButton value="Generar Reporte"
							update="@(.sofia-container-main-update)" actionListener="#{comprar.generateReport()}" >
							<f:param name="id-venta" value="1"/>
						</p:commandButton>

						<p:commandButton value="Descargar"
							rendered="#{reportBean.media ne null}" ajax="false"
							actionListener="#{reportBean.downloadFile}" />
					</h:panelGroup>

					<!--                           -->
					<!-- DIALOG CONFIMATION REMOVE -->
					<!--                            -->
					<p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
						<h:panelGroup layout="block" styleClass="p-d-flex p-jc-end">
							<p:commandButton value="Si" type="button"
								styleClass="ui-confirmdialog-yes" icon="pi pi-check" />
							<p:commandButton value="No" type="button"
								styleClass="ui-confirmdialog-no" icon="pi pi-times" />
						</h:panelGroup>
					</p:confirmDialog>
				</p:fieldset>
			</h:panelGroup>
		</p:fieldset>
	</ui:define>
</ui:composition>