<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--          -->
<!-- TEMPLATE -->
<!--          -->
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	template="../../../template/advanced/template-advaced-admi.xhtml">

	<ui:define name="title-advaced">
			| Cliente | Historial 
	</ui:define>

	<ui:define name="component-statu-advaced">
		<p:menuitem value="Home" url="../index.xhtml" />
		<p:menuitem value="Cliente" url="index.xhtml" disabled="none" />
		<p:menuitem value="Historial" url="all.xhtml" disabled="none" />
	</ui:define>

	<ui:define name="component-title-img-advaced">
		<h:graphicImage library="img" name="all/customers.jpg"
			styleClass="sofia-image-80 sofia-image-dark" />
	</ui:define>
	<ui:define name="component-title-h1-advaced">Cliente</ui:define>
	<ui:define name="component-title-h2-advaced">Historial</ui:define>

	<!--         -->
	<!-- SECTION -->
	<!--         -->
	<ui:define name="component-other-advaced">
		<p:fieldset legend="Historial" toggleable="true" toggleSpeed="500">
			<!-- TITLE -->
			<h1 class="sofia-title p-my-4 p-mb-6">Historial Cliente</h1>

			<!--           -->
			<!-- DATA VIEW -->
			<!--           -->
			<p:dataTable var="c" value="#{table.cliente}"
				widgetVar="sofia-table-update" id="sofia-table-update"
				emptyMessage="No se encontro ningun cliente."
				filteredValue="#{table.filter_cliente}"
				paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} 
								   {CurrentPageReport} {NextPageLink} {LastPageLink}"
				paginator="true" rows="20" rowIndexVar="index"
				rowsPerPageTemplate="5,10,15,20,50,100" reflow="true"
				scrollable="true" styleClass="p-mt-4">

				<!-- HEADER -->
				<f:facet name="header">
					<p:outputPanel layout="block"
						styleClass="p-d-flex p-jc-end p-ac-center">
						<h:outputText value="Buscar:" styleClass="p-mt-1 p-mr-2" />
						<p:inputText id="globalFilter"
							onkeyup="PF('sofia-table-update').filter()" />
					</p:outputPanel>
					<p:outputPanel layout="block"
						styleClass="p-d-flex p-jc-center p-ac-center p-p-3">
						<h2>Clientes</h2>
						<h4 class="p-as-end">(#{table.cliente.size()} resultados)</h4>
					</p:outputPanel>
				</f:facet>

				<!--        -->
				<!-- COLUMN -->
				<!--        -->
				<p:column style="width:50px">
					<p:rowToggler />
					<h:panelGroup layout="block"
						styleClass="p-d-flex p-jc-center p-ac-center">
						<h:outputLabel value="#{index + 1}" />
					</h:panelGroup>
				</p:column>


				<!-- ID -->
				<p:column filterBy="#{c.documento}" sortBy="#{c.documento}"
					footerText="Documento" filterMatchMode="contains"
					headerText="Documento">
					<h:panelGroup layout="block"
						styleClass="p-d-flex p-jc-between p-ac-center">

						<h:outputLabel value="#{c.documento}" styleClass="p-as-center" />

						<!-- IMAGE -->
						<h:panelGroup layout="block"
							styleClass="sofia-container-img-small">
							<h:graphicImage rendered="#{c.persona.foto == null}"
								library="img" name="user.png"
								styleClass="sofia-container-img-small-img" />

							<p:graphicImage rendered="#{c.persona.foto != null}"
								styleClass="sofia-container-img-small-img"
								value="#{image.persona}">
								<f:param name="documento-persona" value="#{c.documento}" />
							</p:graphicImage>
						</h:panelGroup>
					</h:panelGroup>
				</p:column>

				<!-- NAME -->
				<p:column filterBy="#{c.persona.nombre} #{c.persona.apellido}"
					footerText="Nombre" headerText="Nombre"
					sortBy="#{c.persona.nombre} #{c.persona.apellido}">
					<h:panelGroup layout="block"
						styleClass="p-d-flex p-jc-center p-ac-center">
						<h:outputText value="#{c.persona.nombre} #{c.persona.apellido}" />
					</h:panelGroup>
				</p:column>

				<!-- COUNT SALE -->
				<p:column filterBy="#{c.puntos}" footerText="Puntos"
					headerText="Puntos" sortBy="#{c.puntos}">
					<h:panelGroup layout="block"
						styleClass="p-d-flex p-jc-center p-ac-center">
						<h:outputText value="#{c.puntos}" />
					</h:panelGroup>
				</p:column>

				<!-- COUNT SALE -->
				<p:column filterBy="#{c.ventas.size()}" footerText="Ventas"
					headerText="Ventas" sortBy="#{c.ventas.size()}">
					<h:panelGroup layout="block"
						styleClass="p-d-flex p-jc-center p-ac-center">
						<h:outputText value="#{c.ventas.size()}" />
					</h:panelGroup>
				</p:column>

				<!-- ESTATU -->
				<p:column filterBy="#{c.estado}" footerText="Estado"
					headerText="Estado" filterMatchMode="equals">
					<f:facet name="filter">
						<p:selectOneButton onchange="PF('sofia-table-update').filter()"
							styleClass="custom-filter">
							<f:converter converterId="javax.faces.Boolean" />
							<f:selectItem itemLabel="D" itemValue="" />
							<f:selectItem itemLabel="A" itemValue="true" />
							<f:selectItem itemLabel="B" itemValue="false" />
						</p:selectOneButton>
					</f:facet>
					<h:panelGroup layout="block"
						styleClass="p-d-flex p-jc-center p-ac-center">
						<p:commandButton value="#{c.estado ? 'Activo': 'Bloqueado'}"
							title="Cambiar estado" action="#{cliente.estado()}"
							update="@(.sofia-container-main-update)"
							oncomplete="PF('sofia-table-update').clearFilters()"
							styleClass="#{c.estado ? 'sofia-statu-succes': 'sofia-statu-error'} sofia-statu">
							<f:param name="id-cliente" value="#{c.documento}" />
						</p:commandButton>
					</h:panelGroup>
				</p:column>

				<!--        -->
				<!-- EXPANT -->
				<!--        -->
				<p:rowExpansion>
					<!--           -->
					<!-- DATA VIEW -->
					<!--           -->
					<p:dataTable var="v" value="#{c.ventas}"
						rendered="#{c.ventas.size() > 0}"
						widgetVar="sofia-table-ventas-update"
						id="sofia-table-ventas-update"
						emptyMessage="No se encontro ninguna venta del cliente #{c.persona.nombre} #{c.persona.apellido}"
						paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} 
											{PreviousPageLink}   {CurrentPageReport} 
											{NextPageLink} {LastPageLink}"
						paginator="true" rows="20" rowIndexVar="index-venta"
						rowsPerPageTemplate="5,10,15,20,50,100" reflow="true"
						scrollable="true" styleClass="p-mt-4 p-mb-4">

						<!-- HEADER -->
						<f:facet name="header">
							<p:outputPanel layout="block"
								styleClass="p-d-flex p-jc-center p-ac-center p-p-3">
								<h2>Ventas</h2>
								<h4 class="p-as-end">(#{c.ventas.size()} resultados)</h4>
							</p:outputPanel>
						</f:facet>

						<!-- NAME -->
						<p:column footerText="ID" headerText="ID" sortBy="#{v.idVenta}">
							<h:panelGroup layout="block"
								styleClass="p-d-flex p-jc-center p-ac-center">
								<h:outputText value="#{v.idVenta}" />
							</h:panelGroup>
						</p:column>

						<!-- DATE -->
						<p:column footerText="Fecha" headerText="Fecha">
							<h:panelGroup layout="block"
								styleClass="p-d-flex p-jc-center p-ac-center">
								<h:outputLabel value="#{v.fechaRegistro}" />
							</h:panelGroup>
						</p:column>

						<!-- TOTAL -->
						<p:column footerText="Total" headerText="Total"
							sortBy="#{v.total}">
							<h:panelGroup layout="block"
								styleClass="p-d-flex p-jc-end p-ac-center">
								<h:outputLabel value="#{v.total}">
									<f:convertNumber currencySymbol="$" type="currency" />
								</h:outputLabel>
							</h:panelGroup>
						</p:column>

						<!-- TYPE -->
						<p:column footerText="Pago" headerText="Pago">
							<h:panelGroup layout="block"
								styleClass="p-d-flex p-jc-center p-ac-center">
								<h:outputLabel value="#{v.tipoPago.nombre}" />
							</h:panelGroup>
						</p:column>
					</p:dataTable>

					<h:panelGroup layout="block" rendered="#{c.ventas.size() == 0}">
						<h:outputLabel
							value="No se encontro ninguna venta del cliente #{c.persona.nombre} #{c.persona.apellido}"
							styleClass="p-d-block p-text-center sofia-title"
							style="width:70%; margin:1em auto" />
						<h:graphicImage library="img" name="car.png"
							style="width:30%; heigth:40%; display:block; margin:auto" />
					</h:panelGroup>
				</p:rowExpansion>
			</p:dataTable>
		</p:fieldset>
	</ui:define>
</ui:composition>